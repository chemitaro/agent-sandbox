---
種別: 設計補助資料（意思決定レポート）
機能ID: "FEAT-005"
論点ID: "design.md Q-005"
論点名: "`--mount-root` / `--workdir` の片方だけ指定を許可するか"
作成者: "Codex CLI"
最終更新: "2026-01-22"
関連: ["../design.md", "../requirement.md"]
---

# Q-005: `--mount-root` / `--workdir` の片方だけ指定を許可するか

## 0. この論点は何を決めるか（結論の影響）
dynamic 起動の CLI 仕様（ユーザー体験）を決めます。

要件（`@../requirement.md`）で必須なのは以下です:
- 引数なし: `workdir=PWD`、git解析で `mount-root` 自動推定（AC-001/007）
- 両方指定: 指定通り（AC-002）

「片方だけ指定」は要件必須ではないため、**仕様を単純化して除外する**選択ができます。

---

## 0.1 決定（ユーザー回答反映）
- 決定: **選択肢B（片方だけ指定を補完して許可）**
- 補完ルール（確定）:
  - `--mount-root` のみ: `mount-root=<指定>`、`workdir=mount-root`
  - `--workdir` のみ: `workdir=<指定>`、`mount-root` は git 解析で自動推定（非gitなら `mount-root=workdir`）
- 例外/ガード:
  - どの起動パターンでも `workdir ∈ mount-root`（包含関係）を満たさない場合はエラー（EC-001、フォールバックなし）。
  - `--workdir` のみで自動推定が “広すぎる” 場合はエラー（AC-005）し、`--mount-root` の明示指定を促す。

---

## 1. 判断基準（評価軸）
1) **仕様の単純さ / 誤解の少なさ**: ドキュメントと挙動が一致し続けるか  
2) **事故耐性**: 意図しない `mount-root` や `workdir` による誤マウントを増やさないか  
3) **実装・テストの容易さ**: 分岐が増えすぎず、TDD で観測可能にできるか  
4) **ユーザーの利便性**: よく使うユースケースを短く書けるか  

---

## 2. 選択肢

### 選択肢A（推奨）: 片方だけ指定はエラー（両方指定 or どちらも無し）
#### 2.1 メリット
- 仕様が最も単純（入力パターンが 2 つだけ）で、誤解が生まれにくい。
- `workdir ∈ mount-root` チェック（EC-001）が常に明確にできる。
- 実装/テストが簡単（分岐が増えず、AC/EC の対応が明確）。

#### 2.2 デメリット
- 便利さは減る（例: “今いる場所を workdir にして mount-root だけ指定したい” など）。
  - ただし現実的には、`workdir` は PWD を使うケースが多く、`cd` してから `--mount-root` も指定すれば回避できる。

---

### 選択肢B: 片方だけ指定を補完して許可
補完案（例）:
- `--mount-root` のみ: `workdir=mount-root`（指定したディレクトリをマウントし、その直下から作業開始）
- `--workdir` のみ: `mount-root` を git 解析で推定（非gitなら mount-root=workdir）

#### 2.3 メリット
- コマンドが短くなるケースがある（状況によっては便利）。

#### 2.4 デメリット / リスク
- 仕様が増え、説明と実装のズレが起きやすい。
- `--workdir` だけ指定した場合、裏で git 解析（ガード含む）が走り、**失敗理由が分かりにくい**ことがある。
- 「どのディレクトリ基準で相対パス解釈するか」など、細部の追加仕様が必要になりがち。

---

## 3. 推奨案と理由
**決定は B（片方だけ指定を補完して許可）**です。

理由:
- 実運用で「mount-root だけ指定したい」「workdir だけ指定したい」ユースケースが明確であり、入力補完は利便性が高い。
- ただし事故耐性を落とさないため、`workdir ∈ mount-root` と “広すぎる” ガードは必須とする。

---

## 4. あなたが回答するときの項目（コピペ用）
- 回答: B（決定済み）
